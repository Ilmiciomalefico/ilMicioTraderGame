<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <title>ilMicioTrader - Rollercoaster Pro</title>
    <style>
        :root { --neon: #00ff88; --red: #ff3366; --gold: #fbbf24; --bg: #030406; --panel: rgba(15, 23, 42, 0.9); }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Consolas', monospace; overflow: hidden; }
        
        canvas#gameCanvas { position: fixed; top: 0; left: 0; z-index: 1; }

        #ui-layer { position: relative; z-index: 10; height: 100vh; display: flex; flex-direction: column; justify-content: space-between; pointer-events: none; }
        
        .stats-top { 
            padding: 20px; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            display: flex; justify-content: space-between; pointer-events: auto;
        }

        .controls-bottom {
            background: var(--panel); padding: 20px; border-top: 2px solid #1e293b;
            display: flex; flex-direction: column; gap: 15px; pointer-events: auto;
        }

        .input-group { display: flex; gap: 10px; }
        .box { flex: 1; background: #0f172a; border: 1px solid #334155; padding: 10px; border-radius: 8px; }
        .box label { font-size: 10px; color: #64748b; text-transform: uppercase; }
        .box input { background: transparent; border: none; color: white; width: 100%; font-size: 1.2rem; font-weight: bold; outline: none; }

        .btn-row { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 20px; border-radius: 12px; border: none; font-weight: 900; cursor: pointer; text-transform: uppercase; transition: 0.1s; }
        .btn-long { background: var(--neon); color: #000; box-shadow: 0 0 15px rgba(0, 255, 136, 0.3); }
        .btn-short { background: var(--red); color: #fff; box-shadow: 0 0 15px rgba(255, 51, 102, 0.3); }
        .btn-exit { background: #334155; color: #fff; }
        .btn:active { transform: scale(0.98); opacity: 0.8; }

        #price-label { font-size: 2rem; font-weight: 900; color: var(--neon); }
        #pnl-label { font-size: 1.2rem; font-weight: bold; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div class="stats-top">
            <div>
                <div id="balance-label" style="font-size: 1.5rem; font-weight: 900;">$10,000.00</div>
                <div id="pnl-label">P/L: $0.00</div>
            </div>
            <div style="text-align: right;">
                <div id="price-label">--</div>
                <div id="lev-display" style="color: var(--gold); font-size: 0.8rem;">MAX LEV: 500x</div>
            </div>
        </div>

        <div class="controls-bottom">
            <div class="input-group">
                <div class="box">
                    <label>Leverage (Max 500)</label>
                    <input type="number" id="lev-input" value="100" min="1" max="500">
                </div>
                <div class="box">
                    <label>Lot size (Min 0.01)</label>
                    <input type="number" id="lot-input" value="0.10" min="0.01" step="0.01">
                </div>
            </div>
            <div class="btn-row">
                <button class="btn btn-long" onclick="trade('LONG')">Long</button>
                <button class="btn btn-exit" onclick="trade('EXIT')">Exit</button>
                <button class="btn btn-short" onclick="trade('SHORT')">Short</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let points = [], currentPrice = 0, entryPrice = 0;
        let balance = 10000, pnl = 0, mode = 'EXIT', lot = 0.1, lev = 100;
        let gridOffset = 0;

        // Resize
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
        window.onresize();

        function trade(m) {
            if (m !== 'EXIT') {
                lot = parseFloat(document.getElementById('lot-input').value);
                lev = parseInt(document.getElementById('lev-input').value);
                entryPrice = currentPrice;
            } else {
                balance += pnl;
                pnl = 0;
            }
            mode = m;
        }

        function handleData(price) {
            if (!currentPrice) currentPrice = price;
            
            if (mode !== 'EXIT') {
                let diff = (mode === 'LONG' ? (price - entryPrice) : (entryPrice - price));
                // Realistiƒçen izraƒçun: toƒçke * lot * vzvod
                pnl = (diff * lot * lev);
                
                if (balance + pnl <= 0) {
                    balance = 0; pnl = 0; mode = 'EXIT';
                    alert("LIQUIDATED! üíÄ");
                    balance = 10000;
                }
            }
            currentPrice = price;
            points.push(price); if(points.length > 100) points.shift();
            updateUI();
        }

        function updateUI() {
            document.getElementById('balance-label').innerText = "$" + (balance + pnl).toFixed(2);
            document.getElementById('price-label').innerText = currentPrice.toFixed(2);
            const pnlEl = document.getElementById('pnl-label');
            pnlEl.innerText = `P/L: ${pnl >= 0 ? "+" : ""}$${pnl.toFixed(2)}`;
            pnlEl.style.color = pnl >= 0 ? "var(--neon)" : "var(--red)";
        }

        function drawRollercoaster() {
            ctx.fillStyle = "#030406";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dinamiƒçna mre≈æa (Rollercoaster effect)
            gridOffset += (mode === 'EXIT' ? 1 : 5); // Hitreje, ƒçe si v trade-u
            ctx.strokeStyle = "#1e293b";
            ctx.lineWidth = 1;

            for(let i = 0; i < canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                // Ukrivljanje mre≈æe glede na ceno
                ctx.bezierCurveTo(i + 50, canvas.height/2, i - 50, canvas.height/2, i, canvas.height);
                ctx.stroke();
            }

            // Izris grafa
            if (points.length > 2) {
                const min = Math.min(...points), max = Math.max(...points), range = (max-min)||10;
                const getY = (p) => canvas.height/2 - ((p - (min+max)/2) / (range/2)) * (canvas.height/3);

                ctx.beginPath();
                ctx.lineWidth = 4;
                ctx.strokeStyle = mode === 'LONG' ? varColor('--neon') : (mode === 'SHORT' ? varColor('--red') : "#64748b");
                points.forEach((p, i) => {
                    let x = i * (canvas.width / 100);
                    if(i===0) ctx.moveTo(x, getY(p)); else ctx.lineTo(x, getY(p));
                });
                ctx.stroke();
            }
            requestAnimationFrame(drawRollercoaster);
        }

        function varColor(name) { return getComputedStyle(document.documentElement).getPropertyValue(name); }

        // Bitget WS
        const ws = new WebSocket('wss://ws.bitget.com/v2/ws/public');
        ws.onopen = () => ws.send(JSON.stringify({"op":"subscribe","args":[{"instType":"SPOT","channel":"ticker","instId":"BTCUSDT"}]}));
        ws.onmessage = (e) => {
            const d = JSON.parse(e.data);
            if (d.data && d.data[0]) handleData(parseFloat(d.data[0].lastPr));
        };

        drawRollercoaster();
    </script>
</body>
</html>
