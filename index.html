<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ilMicioTrader - 3D Cyber Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-green: #39ff14;
            --neon-red: #ff003c;
            --neon-gold: #ffcc00;
            --bg: #020205;
        }
        body, html { margin: 0; padding: 0; background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; height: 100vh; touch-action: none; }
        
        /* 3D Scene Container */
        #scene-container {
            position: relative; width: 100vw; height: 100vh;
            perspective: 1000px; display: flex; justify-content: center; align-items: center;
        }

        /* UI Overlay */
        #ui-layer {
            position: absolute; top: 20px; width: 90%; display: flex; justify-content: space-between; z-index: 100;
            pointer-events: none;
        }
        .stat-card {
            background: rgba(0,0,0,0.7); border: 2px solid var(--neon-blue);
            padding: 15px; border-radius: 5px; box-shadow: 0 0 15px var(--neon-blue);
        }

        /* Micio & Aura */
        #micio-anchor { position: relative; z-index: 50; transform-style: preserve-3d; transition: transform 0.2s; }
        #micio-sprite { font-size: 100px; filter: drop-shadow(0 0 20px white); cursor: pointer; }
        .aura {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 300px; height: 300px; border-radius: 50%; filter: blur(60px); opacity: 0.4;
        }

        /* 3D Canvas */
        #chartCanvas { position: absolute; inset: 0; z-index: 10; }

        #start-screen {
            position: fixed; inset: 0; background: var(--bg); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .btn-glitch {
            background: transparent; border: 2px solid var(--neon-green); color: var(--neon-green);
            padding: 20px 50px; font-size: 1.5em; cursor: pointer; font-family: 'Orbitron';
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="color:var(--neon-blue); letter-spacing:10px;">3D MICIO</h1>
        <button class="btn-glitch" onclick="init()">ENTER MATRIX</button>
    </div>

    <div id="ui-layer">
        <div class="stat-card">
            <div id="rank-text" style="font-size: 0.8em; color: var(--neon-blue);">RANK: CHUNKY</div>
            <div id="xp-val" style="font-size: 1.5em;">XP 0</div>
        </div>
        <div class="stat-card" style="text-align: right; border-color: var(--neon-gold);">
            <div id="price-val" style="font-size: 0.8em;">BTC/USDT</div>
            <div id="pnl-val" style="font-size: 1.5em; font-weight: 900;">0.00%</div>
        </div>
    </div>

    <div id="scene-container">
        <div id="aura" class="aura" style="background: var(--neon-blue);"></div>
        <div id="micio-anchor">
            <div id="micio-sprite">üê±</div>
        </div>
        <canvas id="chartCanvas"></canvas>
    </div>

    <script>
        let state = { xp: 0, price: 0, entry: 0, pos: 'SHORT', history: [], pnl: 0 };
        const canvas = document.getElementById('chartCanvas');
        const ctx = canvas.getContext('2d');
        const anchor = document.getElementById('micio-anchor');

        function init() {
            document.getElementById('start-screen').style.display = 'none';
            window.addEventListener('resize', resize);
            resize();
            connect();
            animate();
        }

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }

        function connect() {
            const ws = new WebSocket('wss://ws.bitget.com/v2/ws/public');
            ws.onopen = () => ws.send(JSON.stringify({"op":"subscribe","args":[{"instType":"sp","channel":"ticker","instId":"BTCUSDT"}]}));
            ws.onmessage = (e) => {
                const d = JSON.parse(e.data);
                if (d.data && d.data[0]) {
                    state.price = parseFloat(d.data[0].lastPr);
                    state.history.push(state.price);
                    if(state.history.length > 50) state.history.shift();
                    if(state.entry === 0) state.entry = state.price;
                    update();
                }
            };
        }

        function update() {
            let diff = state.pos === 'LONG' ? (state.price - state.entry) : (state.entry - state.price);
            state.pnl = (diff / state.entry) * 100 * 50; 
            if(state.pnl > 0) state.xp += 0.5;
            if(state.pnl <= -100) { state.xp = Math.max(0, state.xp - 50); state.entry = state.price; }

            document.getElementById('pnl-val').innerText = `${state.pnl.toFixed(2)}%`;
            document.getElementById('pnl-val').style.color = state.pnl >= 0 ? 'var(--neon-green)' : 'var(--neon-red)';
            document.getElementById('xp-val').innerText = `XP ${Math.floor(state.xp)}`;
            
            // 3D Tilt based on PnL
            anchor.style.transform = `rotateY(${state.pnl/2}deg) rotateX(${-state.pnl/4}deg) scale(${1 + state.pnl/500})`;
            
            // Rank evolution
            if(state.xp > 500) { 
                document.getElementById('micio-sprite').innerText = "üëë"; 
                document.getElementById('rank-text').innerText = "RANK: GIGA GOD";
                document.getElementById('aura').style.background = "var(--neon-gold)";
            }
        }

        window.onmousedown = () => { state.pos = 'LONG'; state.entry = state.price; };
        window.onmouseup = () => { state.pos = 'SHORT'; state.entry = state.price; };
        window.ontouchstart = (e) => { e.preventDefault(); state.pos = 'LONG'; state.entry = state.price; };
        window.ontouchend = (e) => { e.preventDefault(); state.pos = 'SHORT'; state.entry = state.price; };

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw 3D-like Grid (Perspective Lines)
            ctx.strokeStyle = 'rgba(0, 243, 255, 0.1)';
            ctx.lineWidth = 1;
            for(let i = 0; i < 10; i++) {
                ctx.beginPath();
                ctx.moveTo(canvas.width/2, canvas.height/2);
                ctx.lineTo(Math.random()*canvas.width, canvas.height);
                ctx.stroke();
            }

            // Draw 3D Price Ribbon
            if(state.history.length > 2) {
                let min = Math.min(...state.history);
                let max = Math.max(...state.history);
                let range = max - min || 1;

                ctx.lineWidth = 5;
                ctx.shadowBlur = 20;
                ctx.shadowColor = state.pnl >= 0 ? 'var(--neon-green)' : 'var(--neon-blue)';
                
                for(let i = 1; i < state.history.length; i++) {
                    let x1 = (i-1) * (canvas.width / 50);
                    let x2 = i * (canvas.width / 50);
                    
                    // Perspective calculation (y moves towards center as it goes to the left/past)
                    let y1 = canvas.height/2 + (state.history[i-1] - (min + range/2)) / range * (canvas.height * 0.8) * (i/50);
                    let y2 = canvas.height/2 + (state.history[i] - (min + range/2)) / range * (canvas.height * 0.8) * ((i+1)/50);

                    ctx.beginPath();
                    ctx.strokeStyle = `rgba(0, 243, 255, ${i/50})`;
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.stroke();
                }
            }
            ctx.shadowBlur = 0;
            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>
